# Spam Guard - Thunderbird 拡張機能

ヘッダー分析と機械学習分類を使用したThunderbird向けのインテリジェントなスパム検出。

[English](README.md)

## 機能

- **ヘッダー検出**: スパムヘッダーの自動検出（X-Spam-Status、X-Spam-Flagなど）
- **機械学習分類器**: TF-IDF + ナイーブベイズ分類器によるスパム検出
- **自動スキャン**: 新着メール到着時に自動的にスキャンしてスパムを移動
- **結果ページ**: 検出されたすべてのスパムをソート可能な表で表示し、一括操作が可能
- **設定可能な閾値**:
  - 検出閾値（結果に表示）
  - 自動移動閾値（高確度のスパムを自動的に移動）
- **トレーニング**: 迷惑メール/受信トレイフォルダから学習し、ユーザーフィードバックから学習
- **進行状況表示**: スキャン中のリアルタイム進行状況バー

## インストール

### リリース版から（推奨）

1. [リリース](../../releases)から最新の`.xpi`ファイルをダウンロード
2. Thunderbirdを開く
3. メニュー → アドオンとテーマ に移動
4. 歯車アイコン → ファイルからアドオンをインストール をクリック
5. ダウンロードした`.xpi`ファイルを選択

### ソースから（開発用）

1. このリポジトリをクローン
2. Thunderbirdを開く
3. メニュー → アドオンとテーマ に移動
4. 歯車アイコン → アドオンをデバッグ をクリック
5. 「一時的なアドオンを読み込む...」をクリック
6. `manifest.json`ファイルを選択

## 使い方

### 基本的な使い方

1. ツールバーのSpam Guardアイコンをクリック
2. スキャン時間範囲を選択（50/100/1000日またはすべて）
3. 「すべての受信トレイをスキャン」をクリック
4. ポップアップタブで結果を確認
5. スパムを移動するか、誤検出を安全とマーク

### 結果ページの操作

- **移動**: メールを迷惑メールフォルダに移動
- **安全**: 安全とマーク（トレーニングデータに正常メールとして追加）
- **表示**: Thunderbirdでメールを開く
- 一括選択と操作をサポート
- ソート可能な列（件名、差出人、日付、確率）

### 設定

**一般:**
- スパム検出を有効化
- 新着メッセージの自動スキャン
- スパム移動時に通知を表示
- 対象の迷惑メールフォルダ

**機械学習分類器:**
- 機械学習ベースの検出を有効化
- 検出閾値（50%-90%） - 結果に表示
- 自動移動閾値（95%-100%） - 新着メールを自動移動
- スキャン時間範囲

**トレーニング:**
- 迷惑メール/受信トレイフォルダから学習
- 現在のデータで再トレーニング

## 仕組み

### 1. ヘッダー検出
メールセキュリティシステムによって追加される一般的なスパムヘッダー（X-Spam-Status、X-Spam-Flagなど）を検出します。

### 2. 機械学習分類器
- **特徴量**: 送信者名、メールドメイン、TLD、件名、本文（TF-IDF）
- **アルゴリズム**: ラプラススムージングを用いたナイーブベイズ
- **トレーニング**: 迷惑メール/ジャンクフォルダ（陽性）と受信トレイ（陰性）から学習
- **言語**: 英語、中国語をサポート

### 3. 自動移動ロジック
- ヘッダー検出 → 常に移動（100%信頼度）
- 機械学習検出 ≥ 自動移動閾値 → 自動移動
- 機械学習検出 ≥ 検出閾値 → レビュー用に結果に表示

## ファイル構造

```
spam-guard/
├── manifest.json          # 拡張機能マニフェスト
├── background.js          # 機械学習分類器を含むバックグラウンドスクリプト
├── options/
│   ├── options.html       # 設定ページ
│   └── options.js
├── popup/
│   ├── popup.html         # ポップアップウィンドウ
│   └── popup.js
├── results/
│   ├── results.html       # 結果ページ
│   └── results.js
└── icons/
    └── icon-*.png
```

## 権限

- `messagesRead`: メール内容とヘッダーを読み取り
- `messagesMove`: メールを迷惑メールフォルダに移動
- `accountsRead`: アカウントとフォルダリストを読み取り
- `storage`: 設定、統計、機械学習モデルを保存
- `notifications`: デスクトップ通知を表示

## 要件

- Thunderbird 78.0以上

## トラブルシューティング

**機械学習検出が不正確**
- 機械学習の信頼度閾値を調整
- 誤検出を「安全」とマークしてモデルを改善
- 「迷惑メール/受信トレイフォルダから学習」をクリックして再トレーニング

**スキャンが遅い**
- スキャン時間範囲を短縮（例：50日）
- ヘッダー検出のみを使用する場合は機械学習検出を無効化

**自動移動が機能しない**
- 「スパム検出を有効化」がオンになっているか確認
- 「新着メッセージの自動スキャン」がオンになっているか確認
- 自動移動閾値の設定を確認

## ビルド

```bash
# .xpiパッケージを作成
zip -r spam-guard.xpi manifest.json background.js icons/ options/ popup/ results/ -x "*.md"
```

## ライセンス

MIT License

## 貢献

1. リポジトリをフォーク
2. 機能ブランチを作成
3. 変更をコミット
4. ブランチにプッシュ
5. プルリクエストを作成
